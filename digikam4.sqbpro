<?xml version="1.0" encoding="UTF-8"?><sqlb_project><db path="F:/Users/Rene/Pictures/digikam4.db" readonly="0" foreign_keys="1" case_sensitive_like="0" temp_store="0" wal_autocheckpoint="1000" synchronous="2"/><attached><db schema="PSE" path="F:\R60_Catalog\catalog.pse8db"/></attached><window><main_tabs open="structure browser pragmas query" current="3"/></window><tab_structure><column_width id="0" width="300"/><column_width id="1" width="0"/><column_width id="2" width="125"/><column_width id="3" width="5329"/><column_width id="4" width="0"/><expanded_item id="0" parent="1"/><expanded_item id="1" parent="1"/><expanded_item id="2" parent="1"/><expanded_item id="3" parent="1"/><expanded_item id="4" parent="1"/></tab_structure><tab_browse><current_table name="4,16:mainImageInformation"/><default_encoding codec=""/><browse_table_settings><table schema="main" name="AlbumRoots" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="52"/><column index="2" value="66"/><column index="3" value="63"/><column index="4" value="52"/><column index="5" value="198"/><column index="6" value="167"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="ImageInformation" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="78"/><column index="2" value="61"/><column index="3" value="253"/><column index="4" value="253"/><column index="5" value="105"/><column index="6" value="59"/><column index="7" value="65"/><column index="8" value="68"/><column index="9" value="105"/><column index="10" value="105"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="ImageTags" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="78"/><column index="2" value="54"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="Images" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="52"/><column index="2" value="63"/><column index="3" value="300"/><column index="4" value="63"/><column index="5" value="85"/><column index="6" value="199"/><column index="7" value="88"/><column index="8" value="295"/><column index="9" value="121"/></column_widths><filter_values><column index="3" value="dsc02498.jpg"/></filter_values><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="PSE" name="media_table" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="52"/><column index="2" value="99"/><column index="3" value="488"/><column index="4" value="300"/><column index="5" value="52"/><column index="6" value="252"/><column index="7" value="100"/><column index="8" value="174"/><column index="9" value="158"/><column index="10" value="222"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="PSE" name="media_to_metadata_table" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="89"/><column index="2" value="118"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="PSE" name="metadata_integer_table" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort><column index="3" mode="1"/></sort><column_widths><column index="1" value="216"/><column index="2" value="133"/><column index="3" value="85"/></column_widths><filter_values><column index="2" value="45738"/></filter_values><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="PSE" name="tag_table" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="61"/><column index="2" value="99"/><column index="3" value="281"/><column index="4" value="93"/><column index="6" value="273"/><column index="7" value="165"/><column index="8" value="142"/><column index="9" value="172"/><column index="10" value="277"/><column index="11" value="288"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="PSE" name="tag_to_media_table" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="89"/><column index="2" value="65"/><column index="3" value="120"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="TagProperties" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="54"/><column index="2" value="148"/><column index="3" value="124"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="Tags" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="52"/><column index="2" value="52"/><column index="3" value="223"/><column index="4" value="52"/><column index="5" value="77"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="TagsTree" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="52"/><column index="2" value="52"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table></browse_table_settings></tab_browse><tab_sql><sql name="SQL 1">WITH RECURSIVE
  is_place(n) AS (
    VALUES('14')
    UNION
    SELECT id FROM PSE.tag_table, is_place
     WHERE PSE.tag_table.parent_id=is_place.n
  )
insert into Tags SELECT DISTINCT NULL,71,name,NULL,NULL FROM PSE.tag_table as PST
           WHERE PST.id IN is_place
		     and not exists( select name from Tags where Tags.name = PST.name );
</sql><sql name="SQL 2">insert into ImageTags select im.id, nt.id from PSE.media_table as m
 inner join PSE.tag_to_media_table as tm on m.id = tm.media_id
 inner join PSE.tag_table as t on t.id = tm.tag_id
 inner join Tags as nt on nt.name = t.name
 inner join Images as im on im.name = upper( m.filename_search_index )
 where not exists( select tagid from ImageTags as it where imageid = im.id and tagid = nt.id)  
 
-- select im.id, nt.id, filename_search_index, t.name from PSE.media_table as m</sql><sql name="SQL 5">UPDATE ImageInformation
   SET rating = (SELECT value from PSE.metadata_integer_table as meta 
    inner join PSE.media_to_metadata_table as mm on mm.metadata_id = meta.id
    inner join PSE.media_table as pmed on pmed.id = mm.media_id
    inner join Images as im on im.name = upper(pmed.filename_search_index)
    where ImageInformation.imageid = im.id and description_id = 45738 and value &gt; 0);</sql><sql name="SQL 6">with 
 image_ratings as (SELECT im.id as imageid, value as rating from PSE.metadata_integer_table as meta 
    inner join PSE.media_to_metadata_table as mm on mm.metadata_id = meta.id
    inner join PSE.media_table as pmed on pmed.id = mm.media_id
    inner join Images as im on im.name = upper(pmed.filename_search_index)
    where description_id = 45738 and value &gt; 0)
select * from image_ratings;</sql><sql name="SQL 7">with 
 image_ratings as (SELECT im.id as imageid, value as rating from PSE.metadata_integer_table as meta 
    inner join PSE.media_to_metadata_table as mm on mm.metadata_id = meta.id
    inner join PSE.media_table as pmed on pmed.id = mm.media_id
    inner join Images as im on im.name = upper(pmed.filename_search_index)
    where description_id = 45738 and value &gt; 0)
UPDATE ImageInformation
  set rating = ( select rating from image_ratings
                 where ImageInformation.imageid = image_ratings.imageid )
  where exists( select rating from image_ratings
                 where ImageInformation.imageid = image_ratings.imageid );				 
	</sql><current_tab id="1"/></tab_sql></sqlb_project>
